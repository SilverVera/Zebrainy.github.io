<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
        <style>
            #paymentFormSample {
                display: flex;
                flex-direction: column;
                width: 300px;
            }
        </style>
    </head>
    <script src="https://checkout.cloudpayments.ru/checkout.js"></script>
    <body>
        <form id="paymentFormSample" autocomplete="off">
            <label for="">cardNumber</label>
            <input
                value="4242 4242 4242 4242"
                type="text"
                data-cp="cardNumber"
            />
            <label for="">month</label>
            <input value="12" type="text" data-cp="expDateMonth" />
            <label for="">year</label>
            <input value="22" type="text" data-cp="expDateYear" />
            <label for="">cvv</label>
            <input value="222" type="text" data-cp="cvv" />
            <label for="">name</label>
            <input value="Chad Virgin" type="text" data-cp="name" />
            <label for="">InvoiceId</label>
            <input value="1234567" type="text" data-cp="invoiceId" />
            <button id="btn" type="submit">Оплатить 100 р.</button>
        </form>
        <script>
            const checkout = new cp.Checkout({
                publicId: 'pk_1afcde5122a41d7072fa88e4e1f92',
                container: document.getElementById('paymentFormSample'),
            })
            document.getElementById('btn').onclick = async function (e) {
                e.preventDefault()
                try {
                    const cryptoprogram =
                        await checkout.createPaymentCryptogram()
                    const payment = await fetch(
                        'https://api.cloudpayments.ru/payments/cards/topup',
                        {
                            method: 'POST',
                            headers: {
                                Accept: 'application/json',
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                CardCryptogramPacket: cryptoprogram,
                                Amount: 100,
                                Currency: 'RUB',
                                InvoiceId: checkout.accessors.invoiceId(),
                            }),
                        }
                    )
                    console.log(cryptoprogram)
                } catch (errors) {
                    console.log(errors)
                }
            }
        </script>
    </body>
</html>
